<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Island Survival</title>
  <link rel="icon" href="favicon.svg" type="image/svg+xml">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Rubik:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
    rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: #1a1a2e;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      height: 100dvh;
      overflow: hidden;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      touch-action: none;
      user-select: none;
      -webkit-user-select: none;
    }

    /* ── GAME BOY SHELL ── */
    #gameboy {
      width: min(95vw, 420px);
      max-height: 100vh;
      max-height: 100dvh;
      display: flex;
      flex-direction: column;
      align-items: center;
      background: linear-gradient(160deg, #c8c4be 0%, #b8b4ae 40%, #a8a49e 100%);
      border-radius: 12px 12px 50px 12px;
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,0.4),
        inset 0 -2px 4px rgba(0,0,0,0.1),
        0 8px 32px rgba(0,0,0,0.6),
        0 2px 8px rgba(0,0,0,0.3);
      padding: 12px 12px 16px;
      position: relative;
      overflow: hidden;
    }

    /* Top notch strip */
    #gb-top-strip {
      width: 100%;
      display: flex;
      justify-content: flex-start;
      padding: 0 8px 6px;
    }
    #gb-top-strip .gb-notch {
      width: 40px;
      height: 4px;
      background: linear-gradient(90deg, #8a868a, #9a969a, #8a868a);
      border-radius: 0 0 4px 4px;
    }

    /* Screen bezel */
    #gb-screen-bezel {
      width: 100%;
      background: linear-gradient(145deg, #45435e, #3a384f);
      border-radius: 10px;
      padding: 10px 10px 8px;
      box-shadow:
        inset 0 2px 6px rgba(0,0,0,0.4),
        0 1px 0 rgba(255,255,255,0.15);
    }

    #gb-screen-label {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 0 4px 6px;
    }
    .gb-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #d32f2f;
      box-shadow: 0 0 4px #d32f2f, inset 0 -1px 1px rgba(0,0,0,0.3);
    }
    .gb-power-text {
      font-family: 'Inter', sans-serif;
      font-size: 7px;
      font-weight: 700;
      color: rgba(255,255,255,0.35);
      letter-spacing: 1.5px;
      text-transform: uppercase;
    }

    /* THE SCREEN — Phaser canvas lives here */
    #gb-screen {
      width: 100%;
      aspect-ratio: 1 / 1;
      border-radius: 6px;
      overflow: hidden;
      background: #0d0d0d;
      position: relative;
      box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
    }
    #gb-screen canvas {
      width: 100% !important;
      height: 100% !important;
      display: block;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      touch-action: none;
    }

    #gb-screen-brand {
      text-align: center;
      padding: 5px 0 0;
      font-family: 'Rubik', sans-serif;
      font-size: 9px;
      font-weight: 700;
      font-style: italic;
      color: rgba(255,255,255,0.25);
      letter-spacing: 2px;
      text-transform: uppercase;
    }

    /* ── CONTROLS AREA ── */
    #gb-controls {
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 12px 4px;
      flex-shrink: 0;
    }

    /* JOYSTICK */
    #gb-dpad-area {
      flex: 0 0 auto;
    }
    #virtual-joystick {
      width: 150px;
      height: 150px;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #joystick-base {
      width: 140px;
      height: 140px;
      border-radius: 50%;
      background: linear-gradient(145deg, #3a3836, #2e2c2a);
      box-shadow:
        inset 0 2px 6px rgba(0,0,0,0.5),
        0 1px 0 rgba(255,255,255,0.1);
      position: absolute;
    }
    #joystick-thumb {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(145deg, #5a5856, #4a4846);
      box-shadow:
        0 2px 8px rgba(0,0,0,0.4),
        inset 0 1px 0 rgba(255,255,255,0.15);
      position: absolute;
      transition: transform 0.05s ease-out;
      z-index: 2;
    }

    /* A/B/X/Y BUTTONS */
    #gb-buttons-area {
      flex: 1 1 auto; /* Allow to grow and shrink */
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #gb-dpad-buttons {
      position: relative; /* Establish positioning context */
      display: flex; /* To center its content */
      align-items: center; /* To center its content */
      justify-content: center; /* To center its content */
      width: 100%; /* Make it responsive to its parent */
      aspect-ratio: 1 / 1; /* Maintain square aspect ratio */
      max-width: 200px; /* Max size for the grid */
      max-height: 200px; /* Max size for the grid */
      --offset-from-center: 30%; /* Define offset as a percentage for responsiveness */
    }

    .gb-button-wrapper {
      position: absolute;
      width: 35%; /* Make button wrapper responsive */
      height: 35%; /* Make button wrapper responsive */
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Position individual buttons relative to the center of #gb-dpad-buttons */
    #btn-y {
      top: calc(50% - var(--offset-from-center));
      left: 50%;
      transform: translate(-50%, -50%); /* Center the element on its top/left coordinates */
    }
    #btn-x {
      top: 50%;
      left: calc(50% - var(--offset-from-center));
      transform: translate(-50%, -50%); /* Center the element on its top/left coordinates */
    }
    #btn-a {
      top: 50%;
      left: calc(50% + var(--offset-from-center));
      transform: translate(-50%, -50%); /* Center the element on its top/left coordinates */
    }
    #btn-b {
      top: calc(50% + var(--offset-from-center));
      left: 50%;
      transform: translate(-50%, -50%); /* Center the element on its top/left coordinates */
    }


    .gb-action-btn {
      width: 100%; /* Make button fill its responsive wrapper */
      height: 100%; /* Make button fill its responsive wrapper */
      border-radius: 50%;
      border: none;
      font-family: 'Rubik', sans-serif;
      font-size: 16px;
      font-weight: 700;
      color: rgba(255,255,255,1); /* Changed color to solid white for better visibility */
      cursor: pointer;
      /* removed position: relative; */
      /* Default background, will be overridden by specific buttons */
      background: linear-gradient(145deg, #8b1a3a, #6b1030);
      box-shadow: 0 2px 4px rgba(0,0,0,0.3), inset 0 0 0 1px rgba(255,255,255,0.1);
      touch-action: none;
      -webkit-tap-highlight-color: transparent;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .gb-action-btn:active {
      box-shadow: inset 0 0 10px rgba(0,0,0,0.5), 0 0 2px rgba(0,0,0,0.2); /* Inset shadow for pressed look */
      transform: translateY(1px) scale(0.98); /* Slight translate and scale down */
    }

    /* Specific button colors */
    #btn-a .gb-action-btn {
      background: linear-gradient(145deg, #1a8b3a, #106b30); /* Green */
    }
    #btn-b .gb-action-btn {
      background: linear-gradient(145deg, #8b1a3a, #6b1030); /* Red */
    }
    #btn-x .gb-action-btn {
      background: linear-gradient(145deg, #1a3a8b, #10306b); /* Blue */
    }
    #btn-y .gb-action-btn {
      background: linear-gradient(145deg, #8b8b1a, #6b6b10); /* Yellow */
    }



    /* ── BOTTOM AREA ── */
    #gb-bottom {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 4px 16px 0;
      gap: 8px;
    }

    #gb-select-start {
      display: flex;
      gap: 16px;
      transform: none; /* Remove rotation */
      justify-content: center; /* Center horizontally */
      width: 100%;
      margin-top: 10px; /* Add some space from controls */
    }
    .gb-small-btn {
      width: 48px;
      height: 12px;
      border-radius: 6px;
      border: none;
      background: linear-gradient(145deg, #6a6864, #5a5854);
      box-shadow:
        inset 0 1px 2px rgba(0,0,0,0.3),
        0 1px 0 rgba(255,255,255,0.08);
      font-family: 'Rubik', sans-serif;
      font-size: 6px;
      font-weight: 700;
      letter-spacing: 1px;
      color: #9a9894;
      cursor: pointer;
      touch-action: none;
      -webkit-tap-highlight-color: transparent;
    }
    .gb-small-btn:active {
      transform: translateY(1px);
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.4);
    }

    #gb-brand-text {
      font-family: 'Rubik', sans-serif;
      font-size: 11px;
      font-weight: 700;
      font-style: italic;
      color: #6a6864;
      letter-spacing: 1px;
    }

    /* Speaker grill */
    #gb-speaker {
      align-self: flex-end;
      display: flex;
      flex-direction: column;
      gap: 3px;
      padding: 4px 8px;
    }
    .gb-speaker-line {
      width: 32px;
      height: 2px;
      border-radius: 1px;
      background: #9a9690;
      box-shadow: inset 0 1px 1px rgba(0,0,0,0.2);
    }

    /* ── DEBUG PANEL (desktop only) ── */
    #debug-panel {
      position: fixed;
      left: 0;
      top: 0;
      width: 320px;
      height: 100vh;
      background: #18181b;
      color: #a1a1aa;
      font-family: 'JetBrains Mono', monospace;
      font-size: 12px;
      line-height: 1.6;
      display: flex;
      flex-direction: column;
      z-index: 99999;
      border-right: 1px solid #27272a;
      transition: transform 0.3s ease, opacity 0.3s ease;
    }
    #debug-panel.collapsed {
      transform: translateX(-100%);
      opacity: 0;
      pointer-events: none;
    }
    #debug-toggle {
      position: fixed;
      left: 12px;
      bottom: 12px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #27272a;
      border: 1px solid #3f3f46;
      color: #a1a1aa;
      font-size: 16px;
      cursor: pointer;
      z-index: 100000;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s, transform 0.2s;
    }
    #debug-toggle:hover {
      background: #3f3f46;
      transform: scale(1.1);
    }
    #debug-panel.collapsed ~ #debug-toggle {
      left: 12px;
      bottom: 12px;
    }
    #debug-panel:not(.collapsed) ~ #debug-toggle {
      left: 332px;
      bottom: 12px;
    }
    #debug-panel input {
      width: calc(100% - 24px);
      margin: 12px 12px 0;
      padding: 8px 10px;
      background: #27272a;
      border: 1px solid #3f3f46;
      color: #e4e4e7;
      border-radius: 6px;
      font-family: 'JetBrains Mono', monospace;
    }
    #debug-panel input:focus {
      outline: none;
      border-color: #52525b;
    }
    #debug-logs {
      padding: 12px;
      overflow-y: auto;
      flex-grow: 1;
    }
    #debug-panel details {
      border-bottom: 1px solid #27272a;
      margin-bottom: 8px;
      padding-bottom: 8px;
    }
    #debug-panel details[open] summary {
      color: #e4e4e7;
    }
    #debug-panel summary {
      cursor: pointer;
      font-weight: 500;
      padding: 4px 0;
      user-select: none;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #debug-panel summary::-webkit-details-marker {
      display: none;
    }
    #debug-panel .log-content {
      margin-top: 8px;
      background: #09090b;
      padding: 8px;
      border-radius: 4px;
      white-space: pre-wrap;
      word-wrap: break-word;
      color: #a1a1aa;
      font-size: 11px;
    }
    #debug-panel .log-actions {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }
    #debug-panel button {
      background: #3f3f46;
      border: none;
      color: #fafafa;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 10px;
    }
    #debug-panel button:hover {
      background: #52525b;
    }
    #debug-panel .warn { color: #facc15; }
    #debug-panel .err { color: #f87171; }

    /* Hide debug on mobile */
    @media (max-width: 600px) {
      #debug-panel, #debug-toggle {
        display: none !important;
      }
    }
  </style>
</head>

<body>
  <!-- Debug panel (desktop only) -->
  <div id="debug-panel" class="collapsed">
    <input type="text" id="debug-search" placeholder="Search logs...">
    <div id="debug-logs"></div>
  </div>
  <button id="debug-toggle" title="Toggle debug panel">{}</button>
  <script>
    document.getElementById('debug-toggle').addEventListener('click', function() {
      var panel = document.getElementById('debug-panel');
      var collapsed = panel.classList.toggle('collapsed');
      this.textContent = collapsed ? '{}' : 'X';
    });
  </script>

  <!-- GAME BOY SHELL -->
  <div id="gameboy">
    <div id="gb-top-strip">
      <div class="gb-notch"></div>
    </div>

    <div id="gb-screen-bezel">
      <div id="gb-screen-label">
        <span class="gb-dot"></span>
        <span class="gb-power-text">Paxo Games</span>
      </div>
      <div id="gb-screen">
        <!-- Phaser canvas inserted here via config.parent -->
      </div>
      <div id="gb-screen-brand">Island Survival</div>
    </div>

    <div id="gb-controls">
      <div id="gb-dpad-area">
        <div id="virtual-joystick">
          <div id="joystick-base"></div>
          <div id="joystick-thumb"></div>
        </div>
      </div>

      <div id="gb-buttons-area">
        <div id="gb-dpad-buttons">
          <div id="btn-y" class="gb-button-wrapper">
            <button class="gb-action-btn">Y</button>
          </div>
          <div id="btn-x" class="gb-button-wrapper">
            <button class="gb-action-btn">X</button>
          </div>
          <div id="btn-b" class="gb-button-wrapper">
            <button class="gb-action-btn">B</button>
          </div>
          <div id="btn-a" class="gb-button-wrapper">
            <button class="gb-action-btn">A</button>
          </div>
        </div>
      </div>
    </div>

    <div id="gb-bottom">
      <div id="gb-select-start">
        <button id="btn-select" class="gb-small-btn">SELECT</button>
        <button id="btn-start" class="gb-small-btn">START</button>
      </div>
      <div id="gb-brand-text">ISLAND SURVIVAL</div>
      <div id="gb-speaker">
        <div class="gb-speaker-line"></div>
        <div class="gb-speaker-line"></div>
        <div class="gb-speaker-line"></div>
        <div class="gb-speaker-line"></div>
        <div class="gb-speaker-line"></div>
        <div class="gb-speaker-line"></div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>
  <script src="js/lib/noise.js"></script>
  <script type="module" src="js/world/WorldConfig.js"></script>
  <script type="module" src="js/world/IslandGenerator.js"></script>
  <script type="module" src="js/world/TerrainRenderer.js"></script>
  <script type="module" src="js/player/AnimationManager.js"></script>
  <script type="module" src="js/player/PlayerController.js"></script>
  <script type="module" src="js/ui/HUD.js"></script>
  <script type="module" src="js/world/DayNightCycle.js"></script>
  <script type="module" src="js/world/VegetationManager.js"></script>
  <script type="module" src="js/world/ProximityManager.js"></script>
  <script type="module" src="js/world/TaskDistributor.js"></script>
  <script src="js/SaveManager.js"></script>
  <script src="js/ui/VirtualControls.js"></script>
  <script src="js/scenes/MenuScene.js"></script>
  <script type="module" src="js/scenes/GameScene.js"></script>
  <script type="module" src="js/scenes/PrototypeScene.js"></script>
  <script type="module" src="js/scenes/ProtoBaseScene.js"></script>
  <script type="module" src="js/scenes/ProtoMinimalScene.js"></script>
  <script src="js/main.js"></script>
</body>

</html>
